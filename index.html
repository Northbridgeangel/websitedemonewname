<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escenario 3D â€“ TFG</title>
    <style>
      body { margin: 0; overflow: hidden; background: #000; }
      #ui { position: absolute; top: 20px; left: 20px; z-index: 10; }
      button {
        margin: 5px;
        padding: 8px 14px;
        background: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="ui">
      <button id="editar">Editar</button>
      <button id="mover">Mover</button>
      <button id="salir">Salir</button>
    </div>

    <script>
      // ðŸ”¹ FunciÃ³n para cargar scripts dinÃ¡micamente
      function loadScript(src, callback) {
        const script = document.createElement('script');
        script.src = src;
        script.onload = callback;
        document.head.appendChild(script);
      }

      // ðŸ”¹ Cargamos Three.js primero
      loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/build/three.min.js', () => {

        // ðŸ”¹ Cargamos GLTFLoader
        loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/loaders/GLTFLoader.js', () => {

          // ðŸ”¹ Cargamos OrbitControls
          loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/controls/OrbitControls.js', () => {

            // ðŸ”¹ Cargamos RGBELoader (para fondos .exr)
            loadScript('https://cdn.jsdelivr.net/npm/three@0.163.0/examples/js/loaders/RGBELoader.js', () => {

              // ================================================================
              // ðŸ”¹ CONFIGURACIÃ“N DE LA ESCENA
              // ================================================================
              const scene = new THREE.Scene();

              const camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
              );
              camera.position.set(0, 2, 5);

              const renderer = new THREE.WebGLRenderer({ antialias: true });
              renderer.setSize(window.innerWidth, window.innerHeight);
              renderer.outputEncoding = THREE.sRGBEncoding;
              renderer.toneMapping = THREE.ACESFilmicToneMapping;
              renderer.toneMappingExposure = 1.0;
              document.body.appendChild(renderer.domElement);

              const controls = new THREE.OrbitControls(camera, renderer.domElement);
              controls.enableDamping = true;

              // ================================================================
              // ðŸ”¹ CARGAMOS EL FONDO HDR / EXR
              // ================================================================
              const rgbeLoader = new THREE.RGBELoader();
              rgbeLoader.load('./environment.exr', (texture) => {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.environment = texture;  // iluminaciÃ³n global
                scene.background = texture;   // fondo visible

                console.log('âœ… Fondo EXR cargado correctamente');

                // ================================================================
                // ðŸ”¹ AHORA CARGAMOS EL MODELO GLB
                // ================================================================
                const loader = new THREE.GLTFLoader();
                loader.load(
                  './escenario.glb',
                  (gltf) => {
                    const model = gltf.scene;
                    scene.add(model);
                    console.log('âœ… Modelo GLB cargado correctamente');

                    animate();
                  },
                  undefined,
                  (error) => console.error('âŒ Error al cargar el GLB:', error)
                );
              });

              // ================================================================
              // ðŸ”¹ FUNCIONES DE RENDERIZADO
              // ================================================================
              function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
              }

              window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
              });

              // ================================================================
              // ðŸ”¹ INTERFAZ DE USUARIO (BOTONES)
              // ================================================================
              document.getElementById('editar').onclick = () =>
                alert('Entrando en modo ediciÃ³n...');
              document.getElementById('mover').onclick = () =>
                alert('Modo mover activado');
              document.getElementById('salir').onclick = () =>
                alert('Saliendo de la interfaz');
            });
          });
        });
      });
    </script>
  </body>
</html>
